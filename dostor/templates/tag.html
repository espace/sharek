{% extends 'base.html' %}

{% load settings %}
{% get_setting AJAXIFY as ajaxify %}

{% block title %}{{tag.name}}{% endblock %}

{% block content %}

<div class="row">
    <div class="span12 ">
        <h1 id="headtitle" class="headtitle innerpage offset3"><span>{{tag.name}}</span></h1>
    </div>
</div><!-- row -end -->
<div class="row">

    <div class="span3">
        {% include "sidebar.html" %}
    </div><!-- span3 -->

    <div id="ajax-container" class="span9">
			{% if articles %}

                {% for article in articles %}
                <div class="topic">
                    <h3>
                        <p class="mada-title">
                            <a href="{% url tag tag_slug=tag.get_absolute_url %}{{article.get_absolute_url}}" rel="{{tag.slug}}/{{article.slug}}">{{article.name}}</a>
                            <a href="{% url tag tag_slug=tag.get_absolute_url %}{{article.get_absolute_url}}" class="comments-number pull-left"><i style="margin-top:4px; margin-left:5px;" class="icon-comment icon-white"></i>{% if article.feedback_count > 0 %}{{article.feedback_count}} تعليق{% else %}لا توجد تعليقات{% endif %}</a>
                        </p>
                    </h3>
                    <div class="like-group">
                     <a {% if user %} href="javascript:;" {%else%} href="#not-logged" rel="facebox"{% endif %} class="like rate" id="{{article.id}}" vote="1"><small class="like article {{article.id}}">{{article.likes}}</small></a>
                     <a {% if user %} href="javascript:;" {%else%} href="#not-logged" rel="facebox"{% endif %} class="dislike rate" id="{{article.id}}" vote="0"><small class="dislike article {{article.id}}">{{article.dislikes}}</small></a>
                    </div>  
                    <p>{{article.summary|safe|truncatewords_html:35}}</p>
                </div><!-- topic end -->
                {% endfor %}
                <ul class=" pager">
                    <li class="next">
                    {% if articles.has_next %}
                    <a href="?page={{ articles.next_page_number }}">التالى &larr; </a>
                    {% endif %}
                    </li>
                    <li>
                      <span class="current">
                            صفحه {{ articles.number }} من {{ articles.paginator.num_pages }}.
                      </span>
                    </li>
                    <li class="previous">
                    {% if articles.has_previous %}
                    <a href="?page={{ articles.previous_page_number }}"> &rarr; السابق</a>
                    {% endif %}
                    </li>
                </ul>
            {% else %}
                <div class="topic">
                    <h3>
                        <p class="mada-title">
                            لا توجد مواد متعلقة ب " <span  STYLE="font-size: x-large; color: #B66B5E"> {{tag.name}} </span> "
                        </p>
                    </h3>  
                </div><!-- topic end -->
            {% endif %}
            
			{% if ajaxify %}
            <script type="text/javascript">
             $(document).ready(function() {
                $('.mada-title a').ajaxify({
                    target:'#ajax-container',
                    tagToload: '#ajax-container',
					loading_img:"{{ STATIC_URL }}images/loading.gif",
                    loadHash:'attr:rel'
                });

                $('a[rel*=facebox]').facebox()
                $(".rate").live("click",function(){
                  {% if user %}
                  $.ajax({
                          type:"POST",
                          url :"/sharek/article_vote/",
                          data:{'article':$(this).attr('id'),'type': $(this).attr('vote') ,'csrfmiddlewaretoken': $("{% csrf_token %}").find("input").attr("value")},
                          dataType:"json",
                          error:function(data){},
                          success:function(data){
                          $(".like.article"+"."+{{data.article.id}}).text(data.p);  
                          $(".dislike.article"+"."+{{data.article.id}}).text(data.n);  
                          },
                        });
                  {% endif %}
                });
             });
            </script>
            {% endif %}
    </div>
</div><!-- row end -->

{% endblock %}

